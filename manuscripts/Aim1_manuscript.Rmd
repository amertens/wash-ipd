---
title: "Effect of water, sanitation and hygiene interventions on pathogens in the environment: Individual participant data meta-analysis"
author: "Andrew Mertens, Jack Colford, Oliver Cumming, Joe Brown, Jill Stewart, David Holcomb, Jackie Knee, Tom Clasen, Heather Reese, Amy Pickering, Clair Null, Steve Luby, Jessica Grembi, Ben Arnold, Audrie Lin, Jade Benjamin-Chung, Laura Kwong, Lauren Steinbaum, Ali Boehm, Kara Nelson, Erica Fuhrmeister, Mahbubur Rahman, Sammy Njenga, Rassul Nala, Ayse Ercumen (middle order not finalized)"
#output: redoc::redoc
output: 
  officedown::rdocx_document:
      reference_docx: "manuscript_format.docx"
header-includes:
  - \setlength{\parindent}{4em}
  - \setlength{\parskip}{0em}
indent: true
bibliography: WASH-IPD.bib
bib-humanities: FALSE
csl: nature.csl

---


```{r, include=F}

#Note: Check out this package for integrating any edits from Ayse:
#https://github.com/noamross/redoc

#CSL styles by journal
#https://github.com/citation-style-language/styles


knitr::opts_chunk$set(echo = FALSE, dpi=300,fig.width=7)

options(warn = -1) 
library(officedown)
library(janitor)
library(knitr)
library(here)
# library(table1)
# library(rvest)
library(officer)
library(flextable)
library(bibtex)
library(citr)
library(redoc)
source(here("0-config.R"))
#citr:::insert_citation(bib_file ="WASH-IPD.bib", use_betterbiblatex =F)
# 
# tidy_bib_file(
#   rmd_file = "Aim1_manuscript.Rmd"
#   , messy_bibliography = "WASH-IPD.bib"
#   , file = "tidy_references.bib"
# )



op = function(x, d=2) sprintf(paste0("%1.",d,"f"), x) 

Print <- function(x){
  prettyNum(round(x,2), big.mark = ",", scientific = FALSE)
}

 library(pander)
panderOptions('digits', 2)
panderOptions('round', 2)
panderOptions('keep.trailing.zeros', TRUE)
panderOptions('graph.fontsize', 8)

panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")

set_flextable_defaults(big.mark = ",", 
  font.size = 8, theme_fun = theme_vanilla,
  padding.bottom = 5, 
  padding.top = 5,
  padding.left = 5,
  padding.right = 5)

#load clean data
d <- readRDS(paste0(dropboxDir,"Data/cleaned_ipd_env_data.rds"))
#sample-positive specific dataset
pos <- d %>% filter(!grepl("Any",sample),!grepl("any",sample),!grepl("Any",target), !is.na(pos))
#aggregate samples
pos.agg <- d %>% filter(grepl("Any",sample),grepl("any",sample),grepl("Any",target), !is.na(pos))
#abundance dataset
abund <- d %>% filter(!grepl("Any",sample),!grepl("any",sample),!grepl("Any",target), !is.na(abund))

#number of samples by study
num_samples_by_study <- d %>% filter(!grepl("Any",sample),!grepl("any",sample),!grepl("Any",target), !is.na(pos)) %>% 
  group_by(study, sample, clusterid, dataid, round, sampleid) %>% slice(1) %>%
  group_by(study) %>%
  summarize(N=n()) %>% mutate(study=gsub(" et al.","",as.character(study))) %>% arrange(N)

#number of food prep samples 
FP <- d %>% filter(sample=="FP") %>% group_by(target)

#Load figures and tables
load(here("figures/all_tables.Rdata"))

# load(here("figures/agg_tables.Rdata"))
load(here("figures/abundance_tables.Rdata"))
#Drop low ROQ
tab_unadj_diff <- tab_unadj_diff %>% filter(`ROQ %` >= 50)
tab_adj_diff <- tab_adj_diff %>% filter(`ROQ %` >= 50)

load(here("figures/all_figures.Rdata"))
load(here("figures/subgroup_figures.Rdata"))
#load(here("figures/density_figures.Rdata"))
load(here("figures/outcome_groups.Rdata"))
adj_RR <- readRDS(file=here("results/adjusted_aim1_RR_pooled.Rds")) 
unadj_RR <- readRDS(file=here("results/unadjusted_aim1_RR_pooled.Rds")) 
pooled_adj_RR <- adj_RR %>% filter(study=="Pooled")
adj_RR <- adj_RR %>% filter(study!="Pooled")
adj_diff <- readRDS(file=here("results/adjusted_aim1_diff.Rds")) 
sig_diff <- adj_diff %>% ungroup() %>% filter(pval < 0.05, perc_ROQ >=50) %>% select(study, sample, target, coef, ci.lb, ci.ub, pval, perc_ROQ)

adj_emm <- readRDS(here("results/adjusted_aim1_emm.Rds"))
zoonotic_animals_RR <- readRDS(here("results/adjusted_zoonotic_animals.Rds"))

#Study-specific estimates
protective <- adj_RR %>% ungroup() %>% filter(!is.na(coef),RR<=1) %>% select(sample, target, RR, ci.lb, ci.ub, study)
n_protective <- paste0(round(nrow(protective)/nrow(adj_RR %>% filter(!is.na(coef))) * 100, 1),"% (",nrow(protective),"/",nrow(adj_RR %>% filter(!is.na(coef))),")")

sig <- adj_RR %>% ungroup() %>% filter(ci.lb<1 & ci.ub<1 | ci.lb>1 & ci.ub>1) %>% select(sample, target, RR, ci.lb, ci.ub, study)
n_per_sig <- paste0(round(nrow(sig)/nrow(adj_RR %>% filter(!is.na(coef))) * 100, 1),"% (",nrow(sig),"/",nrow(adj_RR %>% filter(!is.na(coef))),")")

perc_no_pos = round(prop.table(table((adj_RR$minN==0)))*100,1)[2]
num_no_pos = paste0(as.character(sum(adj_RR$minN==0, na.rm=T)),"/",as.character(nrow(adj_RR)))
adj_RR <- adj_RR %>% filter(minN!=0)
num_sparse_pos = paste0(as.character(sum(is.na(adj_RR$coef), na.rm=T)),"/",as.character(nrow(adj_RR)))
adj_sparse <- adj_RR %>% filter(is.na(coef)) %>% mutate(inv_n = N-n)
too_neg=round(mean(adj_sparse$n <= 10 | adj_sparse$a < 2 | adj_sparse$c < 2) * 100, 1)
too_pos=round(mean(adj_sparse$inv_n <= 10 | adj_sparse$b < 2 | adj_sparse$d < 2) * 100, 1)

MST_protect  <- adj_RR %>% filter(grepl("MST", target))
round(prop.table(table(MST_protect$RR<1))[2]*100,1)
#Pvalue adjustment
#min(p.adjust(adj_RR$pval, method="BH"), na.rm=T)

#difference between adjusted and unadjusted

d_unadj_comp<- left_join(adj_RR, unadj_RR, by=c("Y","sample","target","study"))
d_unadj_comp <- d_unadj_comp %>% mutate(log.diff= coef.x-coef.y, log.abs.diff=abs(coef.x-coef.y), diff= RR.x-RR.y, abs.diff=abs(RR.x-RR.y))
med_unadj_diff<-median(d_unadj_comp$log.abs.diff, na.rm=T)


#Clean results function
clean_est <- function(res, outcome="binomial"){
  if(outcome=="binomial"){
    est = round(res$RR, 2)
    ci.lb = round(res$ci.lb, 2) 
    ci.ub = round(res$ci.ub, 2)
    est.ci = paste0(est," (95% CI: ",ci.lb,", ",ci.ub,")")
  }else{
    est = round(res$coef, 2)
    ci.lb = round(res$ci.lb, 2) 
    ci.ub = round(res$ci.ub, 2)
    est.ci = paste0(est," (95% CI: ",ci.lb,", ",ci.ub,")")
  }
  return(est.ci)
}

clean_res  <- function(res, outcome="binomial"){
  if(outcome=="binomial"){
    res$est.ci = paste0("RR=",round(as.numeric(res$RR),1)," (95% CI: ",round(res$ci.lb,1),", ",round(res$ci.ub,1),")")
    res <- res %>% ungroup() %>%
      select(study, sample_type, target_f, est.ci, pval, a, b, c, d, N) 
    res$est.ci <- gsub("RR\\=1 \\(95\\% CI\\: NA, NA\\)","Not estimated",res$est.ci)
    
    res$pval <- as.character(round(res$pval,3))
    res$pval[is.na(res$pval)] <- ""
    res <- res %>% 
      rename(Study=study,
             Sample=sample_type,
             Target=target_f,
             Estimate=est.ci,
             `p-value`=pval, 
             `Positive,\nIntervention`=a,
             `Negative,\nIntervention`=b,
             `Positive,\nControl`=c,
             `Negative,\nControl`=d,
             `Total\nobservations`=N)
  }else{
    res$est.ci = paste0(round(as.numeric(res$coef),1),"Difference= (95% CI: ",round(res$ci.lb,1),", ",round(res$ci.ub,1),")")
    res <- res %>% ungroup() %>%
      select(sample_type, target_f, est.ci, pval, a, b, c, d, N) 
    res$est.ci <- gsub("Difference\\=0 \\(95\\% CI\\: NA, NA\\)","Not estimated",res$est.ci)
    res$pval <- as.character(round(res$pval,3))
    res$pval[is.na(res$pval)] <- ""
    res <- res %>% 
      rename(Study=study,
             Sample=sample_type,
             Target=target_f,
             Estimate=est.ci,
             `p-value`=pval, 
             `Positive,\nIntervention`=a,
             `Negative,\nIntervention`=b,
             `Positive,\nControl`=c,
             `Negative,\nControl`=d,
             `Total\nobservations`=N)
  }
  return(res)
}

clean_res_tab <- function(unadj_RR, adj_RR){
  unadj<-clean_res(unadj_RR) %>% select(Study,Sample,Target,Estimate, `p-value`) %>% 
    rename(`Unadjusted\nEstimate`=Estimate, `Unadjusted\np-value`=`p-value`) 
  adj<-clean_res(adj_RR)%>% rename(`Adjusted\nEstimate`=Estimate, `Adjusted\np-value`=`p-value`)
  
  res <- left_join(unadj, adj, by=c("Study", "Sample", "Target"))
  res <- res %>% arrange(Study,  Sample,  Target) %>% filter(Study!="Pooled")
  res$`Adjusted\nEstimate`[res$Study=="Odagiri 2016"] <- ""
  res$`Adjusted\np-value`[res$Study=="Odagiri 2016"] <- ""
  return(res)
}

FitFlextableToPage <- function(ft, pgwidth = 6){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}


#adj_RR %>% filter(target=="Any virus", sample!="any sample type") %>% select(sample, target, RR, ci.lb, ci.ub, study, a,b,c,d) %>% arrange(sample) %>% as.data.frame()


```

```{css, echo=FALSE}
span.comment-start{
    background: #e0f3db;
}
span.comment-end{
    background: #e0f3db;
}
span.comment-start::after{
    content: " (" attr(author) ", " attr(date) ") [";
}
span.comment-end::before{
    content: "]"
}
span.comment-text{
    background: #fdbb84;
}


```

```{r, echo=FALSE}
commentN <- 0
cmt <- function(txt, cm, author, date = "2021-01-01", comN = commentN){
  cmt_str <- paste0('<span class="comment-text">[',cm,']{.comment-start id="', comN, '" author="', author, '" date="', date, '"}', txt, '[]{.comment-end id="',commentN,'"}</span>')
  assign("commentN", commentN + 1, envir = .GlobalEnv)
  return(cmt_str)
}
```

   
## Abstract
`r cmt(".", "Decide if I have space to include more specific results (especially effect modification results) or discussion", "Andrew", "Date")`

Water, sanitation, and hygiene (WASH) improvements have traditionally been believed to reduce diarrheal disease and improve child health by reducing the  spread of enteric pathogens in the environment. However, recent WASH randomized control trials have had no or mixed effects on improving child health. Measuring fecal pathogens in the environment as an intermediate variable can provide evidence on whether WASH interventions lead to a cleaner environment. Most studies and systematic reviews have relied on fecal indicator bacteria to assess environmental fecal contamination, but these have limitations. Our objective was to assess WASH effects on actual pathogens and microbial source tracking (MST) markers measured in environmental samples through a systematic review and individual participant data meta-analysis of WASH intervention studies. We estimated the impact of interventions on the prevalence of any pathogen or of any MST target and on the prevalence and abundance of specific pathogens or MST targets. We used covariate-adjusted regression models with robust standard errors to account for the clustering of samples in the compound or intervention cluster. We identified and received data from 5 different randomized or quasi-randomized sanitation intervention studies, and estimated a small but significant effect of sanitation interventions on reducing the prevalence of any pathogen, with a pooled, adjusted relative risk of `r clean_est(pooled_adj_RR %>% filter(target=="Any pathogen"))`. There was no overall effect on MST markers, and there was no consistent differences in intervention effects between wet or dry seasons, by animal presence in the household, or between urban versus rural study settings`r cmt(".", "Should final sentence on interpretation be something like (There was evidence WASH interventions slightly reduce environmental contamination, but most study and sample specific estimates were null, partially due to small sample sizes, but also inconsistent intervention effects)", "Andrew", "Date")`



## Introduction

Water, sanitation and hygiene (WASH) improvements aim to reduce childhood enteric infections, subsequent diarrhea disease and growth faltering by reducing child exposure to fecal-orally transmitted pathogens in the environment. Until recently, trials of WASH interventions have primarily focused on documenting health outcomes such as caregiver-reported diarrhea without quantifying intermediate outcomes along the causal chain, such as detection of pathogens in environmental samples and in human biological specimens. Without measuring these causal intermediates, trials are limited to a "black box" understanding, where underlying mechanisms of interventions are unknown and investigators can only speculate about reasons for intervention success or failure.  Inspecting the causal chain is especially important given the small or null effects on child diarrhea and growth achieved in recent well-conducted trials of WASH interventions.[@humphreyIndependentCombinedEffects2019; @lubyEffectsWaterQuality2018; @nullEffectsWaterQuality2018]
   
Pathogens are transmitted from the feces of infected individuals to new hosts through a complex set of interconnected environmentally mediated pathways. Studies that have collected environmental samples to date to assess the effects of WASH interventions on environmental contamination have primarily focused on drinking water (and, to a smaller extent, hands and food) while other pathways such as soil and surfaces in the domestic environment have received less attention.[@sclarAssessingImpactSanitation2016] Household water treatment and handwashing have been associated with reduced fecal contamination of drinking water[@arnoldTreatingWaterChlorine2007] and hands [ref], respectively while sanitation interventions have had limited impact on environmental fecal contamination, including drinking water, hands, objects, surfaces, soil and flies.[@sclarAssessingImpactSanitation2016] 

However, these studies have mostly relied on measuring indicator organisms such as E. coli in the environment as a proxy for pathogens; these indicators can originate from non-fecal sources,[@hardinaSoilEnvironmentalSource1991] cannot differentiate between human vs. animal fecal contamination,[@gruberColiformBacteriaIndicators2014] and correlate poorly with the presence of pathogens.[@wuAreMicrobialIndicators2011] Recent advances in DNA-based diagnostics now allow detection of a range of enteropathogens in human biological specimens and environmental samples,[@lappanMonitoringDiverseEnteric2021; @liuLaboratorydevelopedTaqManArray2013] as well as distinction between human vs. animal fecal sources through molecular source tracking (MST) markers.[@stoeckelPerformanceDesignAnalysis2007] We aimed to assess the effect of WASH interventions on specific pathogens, pathogen types (viruses, bacteria, protozoa, helminths) and human- vs. animal-specific MST markers in the domestic environment with a systematic review and an individual participant data (IPD) meta-analysis.


## Methods

We conducted a systematic literature search to identify WASH intervention trials and quasi-experimental studies that have measured pathogens and/or MST markers in environmental samples as well as at least one of the following health outcomes of interest: (caregiver-reported diarrhea, child growth or pathogens in stool). We focused on studies with environmental as well as child health measurements in order to assess (1) the impact of WASH interventions on environmental contamination, (2) associations between these measures of environmental contamination and child diarrhea, growth and specific enteric infections), and (3) examine the hypothesized causal pathway from WASH intervention to child health mediated through reduced environmental contamination. In this paper, we present findings for the first aim. The analyses for the latter two aims are presented in a companion paper (Mertens 2021).

We developed a search strategy from a two-step process. First, we examined known studies meeting our inclusion criteria for keywords and Medical Subject Heading (MeSH) terms relating to each of the following categories of our search string: WASH interventions; microbial source tracking and environmental contamination; enteric infection; diarrhea; and child growth and development. Next, we performed an initial search using these terms and extracted other relevant terms and synonyms from relevant articles in the search results. Search terms are listed in Supplementary Table 1.

We queried the following databases for relevant studies: PubMed, Embase, CAB Direct Global Health, Agricultural & Environmental Science Database, Web Of Science, Scopus. We only included English language publications published in 2000 or after so that only studies with more recently developed pathogen detection methods were included. We included studies meeting the following inclusion criteria: 1) Randomized controlled trial or quasi-randomized study (i.e., matched cohort, controlled before-and-after study) of a water, sanitation, or hygiene intervention, 2) measured pathogens and/or MST markers in environmental samples, and 3) measured at least one health outcome of interest. We did not include studies that only measured fecal indicator bacteria such as coliforms or *E. coli*, which are commonly used measures of fecal contamination but are not specific to fecal sources and cannot distinguish the  source of contamination.[@motlaghDetectionOccurrenceIndicator2019]

For each identified study, we contacted the authors to request data on the presence and abundance of  pathogen and MST markers measured in environmental samples, as well as child health data, and potentially confounding baseline characteristics. To avoid sharing identifiable data, no GPS locations were shared, and the sampling dates were coarsened to a monthly resolution.

Our primary outcomes were the prevalence of any enteropathogen and of any MST markers in environmental samples. We analyzed prevalences separately for each sample type (e.g., water, hands, soil, flies) and also as a composite prevalence measure indicating presence of the target in any sample type collected from the same household during the same sampling round. Secondary outcomes included the prevalence of specific pathogen types (any viruses, any bacteria, any protozoa, any helminths), the prevalence of specific MST types (general, human, animal, ruminant, avian), the prevalence and abundance of individual enteropathogens, and the prevalence and abundance of individual MST markers. 

We compared each outcome between the WASH intervention and control arms of the included studies.  For prevalence outcomes, we estimated prevalence ratios using modified Poisson regressions.[@zouModifiedPoissonRegression2004] For abundance outcomes, we estimated differences in log-transformed gene copies obtained from molecular methods  using linear regressions, and we estimated count differences of soil-transmitted helminth egg counts from microscopic methods using negative binomial regressions. Because of repeated sampling or clustered designs in some studies, we used the Huber Sandwich Estimator to calculate robust standard errors for all estimates.[@freedmanSoCalledHuberSandwich2006] We used the compound (group of households with shared sanitation) as the independent unit in non-cluster-randomized studies and the specified unit of clustering in cluster-randomized trials. 

We estimated prevalence ratios and abundance differences between intervention and control arms for each pathogen and microbial target by sample type, and also aggregated across samples collected from the same household during the same sampling round. We also estimated prevalence ratios and abundance differences  between intervention and control arms for any pathogen presence, any MST marker, any bacteria, any virus, any protozoa, any helminth, any general MST, any human MST, or any animal MST. 

For the pathogen or MST abundance measures, we imputed values for samples below the limit of quantification (LOQ) and the limit of detection (LOD). We used the original study's imputation strategy if available and imputed ourselves if the original study did not impute non-quantifiable abundances. For samples below the LOD, we used half the LOD and for samples below the LOQ, we used the midpoint between the LOD and LOQ for the imputation. To avoid analyzing targets where most of the data were imputed, we only included targets where at least 50% of samples were within the quantifiable range in our analysis.

All analyses were adjusted for potential confounders. While estimated effects of WASH interventions from randomized controlled trials should be unconfounded due to randomization, covariate adjustment may increase statistical efficiency, and improve exchangeability in comparing and combining estimates with matched cohorts and non-randomized trials.[@cochranCombinationEstimatesDifferent1954] Potential confounders were prescreened using likelihood ratio tests, and only variables associated with the outcome with a p-value < 0.2 were included in the model for each outcome. We included the following variables in the prescreening set if they were measured within an included study: asset-based household wealth, number of people in the household, number of rooms, household construction materials (walls, floor, roof), electrification, age and education of primary caregiver in the household, if anyone in the household works in agriculture, and land ownership. For rare binary outcomes, we only included one independent variable in the model (including the treatment arm and any potential confounders) per 10 positive samples (or per 10 negative samples if <50% of samples were negative). We therefore did not estimate prevalence ratios for any targets with fewer than 10 positive or negative values for a given sample type, or with  fewer than two positive or negative values per study arm for a given sample type. Targets with <10 negatives were also excluded from the composite "any pathogen" and "any MST" variables to avoid generating sparse cells; targets with <10 positives were included in the composite variables. 

Due to differences in environmental and WASH conditions across studies, we reported study-specific estimates for all analyses. For targets where data were available from  four or more studies, we tested for heterogeneity in estimates using Cochran's Q-test.[@cochranCombinationEstimatesDifferent1954a] If there was no significant heterogeneity between individual study estimates (p-value>0.2), we pooled estimates using fixed-effects models. If there was evidence for heterogeneity but there was qualitative support for pooling across studies, we pooled estimates using random-effects models. 

Additionally, we conducted subgroup analyses by season (dry/wet), animal ownership (at least one animal owned/no animal owned) and by zoonotic or non-zoonotic transmission of pathogens. The wet season for each study was defined  as the 6 months of highest average rainfall, obtained from https://www.weather-atlas.com/.[@d.o.oWeatherAtlasWeather] The pathogens we considered zoonotic were *Campylobacter*, *Salmonella*, *Cryptosporidium*, *Yersinia enterocolitica*, *Giardia*, *Ascaris*, and *C. difficile*.[@delahoyPathogensTransmittedAnimal2018] We calculated the prevalence ratios for any pathogen presence and any MST presence between intervention and control groups within these subgroups. Significance of effect modification was determined by the p-values on the interaction terms between the treatment and the indicator for the subgroup in the regression models; a p-value <0.2 was considered evidence of effect modification. There was no heterogeneity in study setting within any individual study as each study was conducted either in a primarily rural or primarily urban setting. We therefore explored heterogeneity by study setting by pooling estimates separately for rural vs. urban studies and comparing the pooled estimates with Wald tests. We used the same approach to explore heterogeneity by study design by separately pooling estimates from randomized and quasi-experimental studies.

All analyses were conducted in R 4.0, and analysis scripts are publicly available (https://github.com/amertens/wash-ipd). The systematic review search strategies and the analysis plan were pre-registered on Open Science Framework (https://osf.io/8sgzn/).



## Results

  The systematic review was conducted on 1/19/2021 and returned 3,376 results after removing duplicates. 3,253 were excluded as irrelevant in the abstract screening stage, and of the 125 remaining studies, 15 met the inclusion criteria after full text screening by two authors. The 15 publications identified included multiple publications from the same intervention studies, and 6 unique interventions were identified by the systematic review. 
  
1.	The WASH Benefits Bangladesh trial [@arnoldClusterrandomisedControlledTrials2013]
2.	The WASH Benefits Kenya trial [@arnoldClusterrandomisedControlledTrials2013]
3.	The MapSan trial in Mozambique[@brownControlledBeforeandafterTrial2015]
4.	The Gram Vikas matched cohort study in India[@reeseDesignRationaleMatched2017]
5.	The Odisha Total Sanitation Campaign trial in India[@clasenEffectivenessRuralSanitation2014]
6.  The CHoBI7 Trial in Bangladesh[@georgeRandomizedControlledTrial2016]

  Data was shared by the primary investigators of the first 5 studies, but the authors of the  CHoBI7 Trial declined to share the data. Only village-level source water quality data was shared from the Total Sanitation Campaign study. The WASH Benefits Kenya and Bangladesh trials were cluster-randomized, multi-armed factorial designed trials of water, hygiene, sanitation, and nutrition interventions, but environmental samples were only collected from the control and sanitation arms. The sanitation intervention was the construction of a double-pit pour flush improved latrine latrine and the provision of a child potty and sani-scoop for feces removal. The MapSan (Maputo Sanitation) study was a controlled before and after trial of a decentralized sanitation intervention in an urban setting. The intervention was the construction of flush toilets to enrollment tanks, shared by a minimum of 15 people. The intervention delivery was not randomized, but control sites were matched based on both size of the compound and time of enrollment. The Gram Vikas study was a matched cohort evaluating the effect of a piped water and sanitation intervention provided by the Gram Vikas non-governmental organization. Gram Vikas built and water tank and piped distribution system, and provided materials for the construction of pour-flush toilets in each household. After each household in the village completed latrine construction, the water system was turned on. The interventions were delivered at a household level in selected villages, and the control villages were matches on matched on pre-intervention characteristics. The Total Sanitation Campaign study in Odisha, India, was a cluster-randomized trial assessing the Government of India's Total Sanitation Campaign, which included latrine promotion and construction of a pour-flush latrine with a single pit and Y-joint for a future second pit.
  
Seven unique studies on pathogen or MST presence in the environment were nested within the 5 randomized and quasi-randomized interventions with shared data. Pathogen and MST detection results was reported in single publications for the Wash Benefits Kenya,[@steinbaumEffectSanitationIntervention2019] MapSan[@holcombHumanFecalContamination2020] Gram Vikas,[@reeseEffectivenessCombinedSanitation2017a] and Odisha studies,[@odagiriHumanFecalPathogen2016] but the WASH Benefits Bangladesh study included three separate publications documenting intervention effects on pathogens and MST markers. These publications were separated by the effect of the sanitation intervention on soil transmitted helminths (STH, [@kwongEffectSanitationImprovements2020]) and on MST markers and other pathogens in two different sets of households collect less than one year[@boehmOccurrenceHostAssociatedFecal2016] and on-average 2 years[@fuhrmeisterEffectSanitationImprovements2020] after intervention. We report results from these three studies separately due to differences in type and timing of sample collections. We received unpublished data on fly pathogens detected on flies caught in the household from the MapSan study, which we include within the Holcomb 2020 study in the reported results.
  
There were `r Print(nrow(pos %>% group_by(study, sample, clusterid, dataid, round, sampleid) %>% slice(1)))` total samples in the shared data across the 5 trials, with `r Print(nrow(pos))` total pathogen/MST target prevalences assessed across all samples. Table 1 shows the specific pathogen prevalence by study and sample type. Table 2 shows the specific MST prevalence by study and sample type. Number of samples by study varied, from only `r num_samples_by_study$N[1]` village water source samples from `r num_samples_by_study$study[1]` to `r num_samples_by_study$N[7]` samples from `r num_samples_by_study$study[7]`. `r num_samples_by_study$study[2]` had `r num_samples_by_study$N[2]` samples, `r num_samples_by_study$study[3]` had `r num_samples_by_study$N[3]` samples, `r num_samples_by_study$study[4]` had `r num_samples_by_study$N[4]` samples, `r num_samples_by_study$study[5]` had `r num_samples_by_study$N[5]` samples, and `r num_samples_by_study$study[6]` had `r num_samples_by_study$N[6]` samples. 

Odigari 2016 sampled village water sources, Reese 2017 sampled household water sources and stored household water,and Holcomb 2020 sampled household and latrine soil, food, source and stored water, and flies caught in the compounds latrine and kitchen. Of the WASH Benefits trial studies, Wash Benefits Kenya only sampled STH in soil, while WASH Benefits Bangladesh included samples from soil, child and mother hands, and drinking water. Steinbaum 2019 and Kwong 2021 sampled household soil for STH in Kenya and Bangladesh, respectively, Boehm 2016 collected a rinse of child hands, stored household drinking water, and household soil, and Fuhrmeister 2020 collected both mother and child hand rinses, stored household drinking water, and household soil.
  
Across the seven studies, three only measured pathogens and not MST markers; two WASH Benefits trial studies measured *Ascaris lumbricoides* and *Trichuris trichiura* STH eggs in soil,[@kwongEffectSanitationImprovements2020; @steinbaumEffectSanitationIntervention2019] and Reese 2017 measured *V. cholerae* and *Shigella*.

Boehm 2016 measured Rotavirus as well as general, human, and animal fecal genetic markers, Fuhrmeister 2020 measured pathogenic *E. coli*, *Giardia*, Norovirus, and human and animal fecal markers,[@fuhrmeisterEffectSanitationImprovements2020], and Odagiri 2016 measured *V. cholerae*, rotavirus, adenovirus, and general, human, and animal fecal genetic markers. Holcomb 2020 measured the largest number of targets, including pathogenic *E. coli*, *V. cholerae*, *Shigella*, Adenovirus, Astrovirus, *Cryptosporidium*, *Entamoeba histolytica*,  Rotavirus, *Salmonella*, *Yersinia*, *C. difficile*, Norovirus, Sapovirus, *Campylobacter*, pan-enterovirus, *Giardia*, STH, and general, human, and animal fecal genetic markers (Tables 1,2).

Many targets had very low or no variation in prevalence, with `r num_no_pos` target-sample combinations having no variation in prevalence, and `r num_sparse_pos` of the remaining combinations having too little variation to estimate a prevalence ratio. Most (`r too_neg`%) of the sparse contrasts had too few positive samples, but `r too_pos`% of sparse contrasts had too few negative samples. Specifically, BacCow MST markers from Odagiri 2016, GenBac3 in Boehm 2016, and human Bacteroides in Holcomb 2020 had close to 100% prevalence, also leading to high positivity in aggregate targets. To keep the targets with close to 100% positivity from preventing the estimation of prevalence ratios in the aggregate outcomes, we did not include these three targets in calculating the aggregate outcomes for their respective studies. Reese 2017 measured human (Bacteroides and M. smithii) and avian (GFD) MST targets in `r FP %>% ungroup() %>% distinct(sampleid) %>% summarise(N=n()) %>% as.numeric()` food samples, but there were no samples positive for GFD, 2 samples positive for M. smithii, and 7 samples positive for Bacteroides, so there are no estimates from food samples reported in the figures. Overall, study-specific estimates were largely homogeneous, with no significant Cochran's Q-tests of homogeneity among pooled estimates. Therefore, pooled estimates are based on fixed-effects models. 

Among the sample-target combinations with sufficient data, interventions mostly decreased prevalences by a non-significant amount, with `r n_protective` protective estimated study-specific effects of interventions and `r n_per_sig` insignificant study-specific estimates. Overall, there was a decreased risk of detecting any pathogen within any sample collected within the compound, with an adjusted RR of `r clean_est(pooled_adj_RR %>% filter(target=="Any pathogen"))`, when pooled across all studies using random effects models (Figure 1). Interventions decreased the risk of any pathogen presence across all specific studies except for Boehm 2016, but the decrease was only significant in Fuhrmeister 2020 with an adjusted RR of `r clean_est(adj_RR %>% filter(target=="Any pathogen", sample=="any sample type", study=="Fuhrmeister 2020"))`. Among specific samples types, sanitation interventions had no significant effects (Figure 1). Sanitation interventions also had no effects on MST marker prevalences when aggregated across any sample type or within specific sample types.


When examining prevalences of types of pathogens, interventions reduced the prevalence of bacterial pathogens in any sample type, with an adjusted, pooled RR of `r clean_est(pooled_adj_RR %>% filter(target=="Any bacteria"))`, though the effect was not significant in any individual study (Figure 2). Interventions did not reduce the presence of viruses, protozoa, or STH overall or within specific types of samples, though point estimates were protective for all combinations except for viruses on child and mother's hands. Among specific pathogens, interventions reduced prevalences within any sample type for pathogenic *E. coli* in Fuhrmeister 2020 (Adjusted RR: `r clean_est(adj_RR %>% filter(target=="Pathogenic E. coli", sample=="any sample type", study=="Fuhrmeister 2020"))`) and for Adenovirus, *Ascaris*, and *Shigella* in Holcomb 2020 (Adenovirus adjusted RR: `r clean_est(adj_RR %>% filter(target=="Adenovirus", sample=="any sample type", study=="Holcomb 2020"))`, *Ascaris* adjusted RR: `r clean_est(adj_RR %>% filter(target=="Ascaris", sample=="any sample type", study=="Holcomb 2020"))`, *Shigella* adjusted RR: `r clean_est(adj_RR %>% filter(target=="Shigella", sample=="any sample type", study=="Holcomb 2020"))`, supplementary figure 1). These reductions were driven specifically by significant reductions in soil samples in Holcomb 2020 and by non-significant reductions in all sample types in Fuhrmeister 2020.

Among types of MST markers, effects of interventions were inconsistent and largely null, with only `r round(prop.table(table(MST_protect$RR<1))[2]*100,1)`% of estimated study-specific prevalence ratios indicating a protective effect of interventions (Figure 3). The only significant estimates was for any animal MST in stored water samples in Boehm 2016 with and adjusted RR of `r clean_est(adj_RR %>% filter(target=="Any animal MST", sample=="W", study=="Boehm 2016"))`, driven primarily by a significant effect of the sanitation intervention on the Bac-Ruminant (BacR) animal MST markers (supplementary figure 2, adjusted RR: `r clean_est(adj_RR %>% filter(target=="Animal (BacR)", sample=="W", study=="Boehm 2016"))`). 

Of all the samples collected, `r round(prop.table(table(is.na(d$abund)))*100,1)[1]`% had abundances quantified. Soil transmitted helminths in Steinbaum 2019 and Kwong 2021 were counted and MST targets in were quantified in Boehm 2016, Fuhrmeister 2020, and Holcomb 2020`r cmt(".", "Add by which methods. Then, note number of sample with abundances", "Andrew", "Date")` Of samples part of the quantitative analysis, `r round(prop.table(table(d$qual))*100,1)[1]`% were below the limit of detection, `r round(prop.table(table(d$qual))*100,1)[4]`% were below the limit of quantification, and `r round(prop.table(table(d$qual))*100,1)[4]`% were in the range of quantification. Of targets enumerated within specific sample types,  `r round(prop.table(table(adj_diff$perc_ROQ>=50))[1] * 100,1)`% had less than 50% of samples with abundances within the range of quantification. We estimated differences between the intervention and control arms for the other `r round(prop.table(table(adj_diff$perc_ROQ>=50))[2] * 100,1)`% of target-sample combinations, and table 3 shows the mean log10-transformed abundances stratified by intervention as well as covariate-adjusted differences in abundances for these combinations. Sanitation interventions had significant effects on the abundance of three MST targets, but not on STH egg counts. The prevalence ratio of general *Bacteroidales* (GenBac3) was not calculable in household soil samples in Boehm 2016 as GenBac3 was detected in `r round(mean(d$pos[d$study=="Boehm 2016" & d$sample=="S" & d$target=="General (GenBac3)"], na.rm=T)*100,1)`% of samples, but the concentration was lower in the intervention arm, with an adjusted log10-transformed differences of `r clean_est(sig_diff %>% filter(study=="Boehm 2016", sample=="S", target=="General (GenBac3)"), outcome="diff")`.  BacCow abundance was lower on mother's hands in the intervention arm in Fuhrmeister 2020, with an adjusted differences of `r clean_est(sig_diff %>% filter(study=="Fuhrmeister 2020", sample=="MH", target=="Animal (BacCow)"), outcome="diff")`. However, the sanitation intervention in Holcomb 2020 significantly increased *Bacteroides* concentrations in flies caught in latrines (adjusted difference: `r clean_est(sig_diff %>% filter(study=="Holcomb 2020", sample=="FlyLat", target=="Human (Bacteroides)"), outcome="diff")`; table 3).

Supplementary figure 3 shows the effects of interventions on any pathogen and any MST prevalence, stratified by wet and dry season. The wet season was May through October in Wash Benefits Bangladesh and the Gram Vikas and Odisha studies in India. The wet season in the MapSan study in Maputo, Mozambique was November through April. Western Kenyan has two distinct periods of high rain, so the wet season was defined as March-May and October-December for WASH Benefits Kenya. Interventions had significantly different effects by season in several study-specific sample types, but the direction of the effect was inconsistent. `r cmt("Note significant interactions.", "Add", "Andrew", "Date")` Seasonality effect, but inconsistent direction. There was no effect modification by animals in the compounds, however there were few compounds without animals (supplementary figures 4). There were no differences in intervention effects on pathogens with a possible zoonotic origin versus pathogens with only human hosts (supplementary figure 5). Non-zoonotic pathogens were more common, with 31.5% of samples testing non-zoonotic pathogens detecting at least one, while 28.8% of samples with zoonotic targets tested has at least one test positive. Of samples with any pathogen detected, 98.4% detected at least one non-zoonotic pathogen, while 63.9%  detected at least one zoonotic pathogens. Samples from compounds with animals in them did not have a higher prevalence of pathogens with zoonotic origins than compounds without animals, with and adjusted, pooled prevalence ratio of `r clean_est(zoonotic_animals_RR %>% filter(target=="Any zoonotic", sample=="any sample type"))`. There were also no significant differences between urban (Holcomb 2020) and rural (all other) studies or between trial and matched cohorts designs for sample-target combinations with at least 4 study-specific estimates. Lastly, overall, unadjusted estimates did not vary greatly from adjusted estimates with a median absolute difference in log-relative risks of `r round(med_unadj_diff,4)` (supplementary figures 6-8)`r cmt(".", "To do: * note significant abundance results with low ROQ% * discuss specific non-zoonotic pathogens decreased* Before discussing prevalence ratios, give absolute prevalences for primary outcomes * note dropping of baseline (pre-intervention) measures from mapsan * add study-specific methods of detecting/quantifying targets * N and percent in wet season and with animals in the compound. * give all the pooled estimates (even insignificant) *add a column of percent within ROQ in table 3", "Andrew", "Date")`

  


## Discussion

We obtained individual participant data from identified studies for an IPD analysis. Unlike conventional meta-analyses that statistically pool reported summary estimates from different studies, IPD analysis pools raw data from individual studies and then estimates the effect of interest.[@rileyMetaanalysisIndividualParticipant2010a] The IPD approach has several advantages over pooling independently derived effect estimates from different studies. While effect estimates are often reported differently across studies (e.g., odds ratio vs. relative risk), individual participant data allow direct derivation of the effect estimate of interest, regardless of how it was reported in the original studies. The statistical analysis approach can also be standardized across studies, including adjusting for baseline factors consistently and using consistent statistical models. 

Despite differences in study settings and WASH intervention designs across the 5 WASH intervention studies, there were relatively consistent results, with no statistically significant heterogeneity in any of the pooled estimates. Study-specific estimates were primarily null, though  `r str_split(n_protective," ", simplify=T)[1,1]` were protective, and there was an overall significant protective effect of interventions on reducing pathogen prevalence in any sample. There was not an effect of reducing MST marker prevalence`r cmt(".", "Discuss other key results", "Andrew", "Date")` 

-most quantified samples were below the range of quantification


Most study-specific estimates had small sample sizes and rare outcomes due to very low prevalences (and sometimes very high prevalences). We did not correct for multiple comparisons, and pooled estimates would no longer be significant after correction, but many contrasts may also be underpowered. Additionally, the consistency of the protective directions of intervention effects, and the significant pooled effect of interventions on any pathogen in any sample.

The methods used to detect specific pathogens or MST markers are less common and more expensive than coliform or *E. coli* sampling, contributing to the small number of included studies and smaller sample sizes of environmental samples within the studies. Across the included studies, 9% (in Boehm 2016) to 35% (in Reese 2017) of study households had environmental samples collected and tested for pathogens or MST markers`r cmt(".", "WBK 2,107 HH of 8,246 HH 25%, WBB 5551 HH, Boehm 497 9%, Furhmeister 600 HH, 11%, Mapsan 94 HH of 760 12%, GV 840 of 1123+1275 35%, Odisha sampled water sources", "Andrew", "Date")` DNA-based diagnostics allow for the detection of specific enteropathogens to better test if WASH interventions clean up the domestic environment in ways that reduce the risks of pathogenic infections, but the trade-off is a decreased power to detect intervention effects. The individual-participant meta-analysis nature of this study allowed us to detect effects not found in individual studies, but we were unable to estimate study-specific effects for many targets due to data sparsity. Advances in technology that reduce the costs of DNA-based diagnostics, or better funding for environmental testing of specific enteropathogens within WASH trials, may more precisely estimate the impact of WASH interventions on environmental contamination.

Another limitation was   

-note that we detected some pooled significant effects that were protective but insignificant within individual studies/samples due to increased power/sample size

  *  Discuss significant results and any consistencies across studies. 
  *  Discuss differences in interventions across studies
  *  Differences in adjusted vs. unadjusted estimates
  * Effect modification
   
  *  Limitations
    * Sparse in many categories
    * Abundance imputation
    * Urban vs. rural
  * Future research needs?
  
  * Note insignificant seasonality effect in Kwong et al when defining wet as June-Oct
    * Larger impact in matched cohorts instead of trials, possibly an effect of residual confounding (neither significant after subdividing)
  * can I use RMA() to test the difference and get a pval
  * discuss water intervention component of X study, and if it had a larger impact on water samples.

  
## Conclusion


## Figures

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 4.5, fig.align = 'left'}

p_adj_1

```

__Figure 1.__ Forest plots of intervention effects on any enteropathogen, and any MST markers in different types of environmental samples. Pooled estimates are presented when there are four or more study-specific estimates for a specific sample type and target combination. Empty, grey, crossed points denote data that were too sparse  to estimate a prevalence ratio (i.e., prevalence <5% or >95%, or <10 positive observations). All estimates are adjusted for potential confounders. Pooled estimates are estimated when there are four or more study-specific estimates and are denoted with diamond-shaped points. Samples of the same type by from different locations or individuals in the compound are stratified and plotted adjacent to each other. 

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_adj_3

```

__Figure 2.__ Forest plots of intervention effects on any virus, any bacteria, any protozoa and any STH prevalences in different types of environmental samples.

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_adj_2

```

__Figure 3.__ Forest plots of intervention effects on  any general, human and animal MST markers in different types of environmental samples.



## Tables


### Table 1. Prevalence of pathogens by sample type tested in each study 

```{r, echo=F, warning=F, message=F,  results = 'asis'}
# autofit(flextable(target_presence_long_P))
# 
FitFlextableToPage(flextable(target_presence_long_P))

```



### Table 2. Prevalence of microbial source tracking markers by sample type tested in each study

```{r, echo=F,  results = 'asis'}
# autofit(flextable(target_presence_long_MST))
#target_presence_long_MST <- target_presence_long_MST  %>% flextable(theme_fun = theme_box)

FitFlextableToPage(flextable(target_presence_long_MST))

```



### Table 3. Mean (SD) abundances by study arm  arm and adjusted abundance differences between intervention and control arms

`r cmt(".", "Fix NA in the mean column, -note in table 3 that the means are log10-transformed", "Andrew", "Date")` 

```{r, echo=F, results = 'asis'}
FitFlextableToPage(flextable(tab_adj_diff))

```
*Marks estimates from negative binomial models.





## Supplementary Figures

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 10}

p_adj_s1

```

__Supplementary Figure 1.__ Prevalence of specific pathogens. 


```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 10}

p_adj_s2

```

__Supplementary Figure 2.__ Prevalence of specific MST markers. 



```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_wet_1

```

__Supplementary Figure 3.__ Forest plots of intervention effects on any enteropathogen, and any MST markers in different types of environmental samples, stratified by if the sample wast collected suring the wet versus the dry season (defined by the 6 months of highest average rainfall). Significant effect modification, as determined by the p-values on the regression model interaction term, is marked with asterisks (P < 0.05 = "\*", P < 0.01 = "\*\*", P < 0.001 = "\*\*\*"). 

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_animals_1

```

__Supplementary Figure 4.__ Forest plots of intervention effects on any enteropathogen, and any MST markers in different types of environmental samples, stratified by the presence of any animals in the compound.  Significant effect modification, as determined by the p-values on the regression model interaction term, is marked with asterisks (P < 0.05 = "\*", P < 0.01 = "\*\*", P < 0.001 = "\*\*\*"). 

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_zoo

```

__Supplementary Figure 5.__ Forest plots of intervention effects on any enteropathogen in any type of environmental samples, stratified by whether the pathogen can have a zoonotic origin.


```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 4.5}

p_unadj_1

```

__Supplementary Figure 6.__ Forest plots of unadjusted intervention effects on any enteropathogen, and any  MST markers in different types of environmental samples. Pooled estimates are presented when there are four or more study-specific estimates for a specific sample and target combination. Empty, grey, crossed points denote contrasts where data existed but with either too low or too high a prevalence to estimate a prevalence ratio. All estimated are adjusted for potential confounders. 

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_unadj_3

```

__Supplementary Figure 7.__ Forest plots of unadjusted intervention effects on any virus, any bacteria, any protozoa and any STH prevalences in different types of environmental samples.

```{r, echo=F, warning=F, message=F, fig.width = 7, fig.height = 5}

p_unadj_2

```

__Supplementary Figure 8.__ Forest plots of unadjusted intervention effects on any general, human and animal MST markers in different types of environmental samples.






## References