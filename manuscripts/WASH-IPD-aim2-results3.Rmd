---
title: "Associations between enteropathogens detected in the environment and child growth and enteric infections: an individual participant data meta-analysis"
author: "Andrew Mertens, Jack Colford, Oliver Cumming, Joe Brown, Jill Stewart, David Holcomb, Drew Capone, Jackie Knee, Tom Clasen, Heather Reese, Amy Pickering, Clair Null, Steve Luby, Jessica Grembi, Ben Arnold, Audrie Lin, Jade Benjamin-Chung, Laura Kwong, Lauren Steinbaum, Ali Boehm, Kara Nelson, Erica Fuhrmeister, Mahbubur Rahman, Sammy Njenga, Rassul Nala, Ruwan Thilakaratne, Ayse Ercumen (middle order not finalized)"
#output: redoc::redoc
output: 
  word_document:
    reference_docx:  "tables_format.docx"
header-includes:
  - \setlength{\parindent}{4em}
  - \setlength{\parskip}{0em}
indent: true
bibliography: WASH-IPD.bib
bib-humanities: FALSE
csl: nature.csl

---


```{r, include=F}

#Note: Check out this package for integrating any edits from Ayse:
#https://github.com/noamross/redoc

#CSL styles by journal
#https://github.com/citation-style-language/styles


knitr::opts_chunk$set(echo = FALSE, dpi=300,fig.width=7)

options(warn = -1) 
library(officedown)
#library(janitor)
library(knitr)
library(here)
# library(table1)
# library(rvest)
library(officer)
library(flextable)
library(bibtex)
library(citr)
library(redoc)
library(kableExtra)
library(ggforce)
library(RColorBrewer)

textcol = "grey20"
cols = (brewer.pal(n = 9, name = "Spectral"))
colours <- c(`<0.01 increase risk` = cols[1], `<0.05 increase risk` = cols[2], 
             `0.05-0.2 increase risk` = cols[3], `0.2-0.5 increase risk` = cols[4], 
             `0.5-1` = cols[5], `0.2-0.5 decrease risk` = cols[6], 
             `0.05-0.2 decrease risk` = cols[7], `<0.05 decrease risk` = cols[8], 
             `<0.01 decrease risk` = cols[9], `Not estimated` = "gray80")


source(here("0-config.R"))
#citr:::insert_citation(bib_file ="WASH-IPD.bib", use_betterbiblatex =F)
# 
# tidy_bib_file(
#   rmd_file = "Aim1_manuscript.Rmd"
#   , messy_bibliography = "WASH-IPD.bib"
#   , file = "tidy_references.bib"
# )



op = function(x, d=2) sprintf(paste0("%1.",d,"f"), x) 

Print <- function(x){
  prettyNum(round(x,2), big.mark = ",", scientific = FALSE)
}

 library(pander)
panderOptions('digits', 2)
panderOptions('round', 2)
panderOptions('keep.trailing.zeros', TRUE)
panderOptions('graph.fontsize', 8)

panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")

set_flextable_defaults(big.mark = ",", 
  font.size = 8, theme_fun = theme_vanilla,
  padding.bottom = 5, 
  padding.top = 5,
  padding.left = 5,
  padding.right = 5)


#Clean results function
clean_est <- function(res, outcome="binomial"){
  if(outcome=="binomial"){
    
    est = format(round(res$RR, 2), nsmall = 2)
    ci.lb = format(round(res$ci.lb, 2), nsmall = 2) 
    ci.ub = format(round(res$ci.ub, 2), nsmall = 2)
    est.ci = paste0(est," (95% CI: ",ci.lb,", ",ci.ub,")")
  }else{
    est = format(round(res$coef, 2), nsmall = 2)
    ci.lb = format(round(res$ci.lb, 2), nsmall = 2) 
    ci.ub = format(round(res$ci.ub, 2), nsmall = 2)
    est.ci = paste0(est," (95% CI: ",ci.lb,", ",ci.ub,")")
  }
  return(est.ci)
}

clean_res  <- function(res, outcome="binomial"){
  if(outcome=="binomial"){
    res$est.ci = paste0("RR=",round(as.numeric(res$RR),1)," (95% CI: ",round(res$ci.lb,1),", ",round(res$ci.ub,1),")")
    res <- res %>% ungroup() %>%
      select(study, sample_type, target_f, est.ci, pval, a, b, c, d, N) 
    res$est.ci <- gsub("RR\\=1 \\(95\\% CI\\: NA, NA\\)","Not estimated",res$est.ci)
    
    res$pval <- as.character(round(res$pval,3))
    res$pval[is.na(res$pval)] <- ""
    res <- res %>% 
      rename(Study=study,
             Sample=sample_type,
             Target=target_f,
             Estimate=est.ci,
             `p-value`=pval, 
             `Positive,\nIntervention`=a,
             `Negative,\nIntervention`=b,
             `Positive,\nControl`=c,
             `Negative,\nControl`=d,
             `Total\nobservations`=N)
  }else{
    res$est.ci = paste0(round(as.numeric(res$coef),1),"Difference= (95% CI: ",round(res$ci.lb,1),", ",round(res$ci.ub,1),")")
    res <- res %>% ungroup() %>%
      select(sample_type, target_f, est.ci, pval, a, b, c, d, N) 
    res$est.ci <- gsub("Difference\\=0 \\(95\\% CI\\: NA, NA\\)","Not estimated",res$est.ci)
    res$pval <- as.character(round(res$pval,3))
    res$pval[is.na(res$pval)] <- ""
    res <- res %>% 
      rename(Study=study,
             Sample=sample_type,
             Target=target_f,
             Estimate=est.ci,
             `p-value`=pval, 
             `Positive,\nIntervention`=a,
             `Negative,\nIntervention`=b,
             `Positive,\nControl`=c,
             `Negative,\nControl`=d,
             `Total\nobservations`=N)
  }
  
  return(res)
}

clean_res_tab <- function(unadj_RR, adj_RR){
  unadj<-clean_res(unadj_RR) %>% select(Study,Sample,Target,Estimate, `p-value`) %>% 
    rename(`Unadjusted\nEstimate`=Estimate, `Unadjusted\np-value`=`p-value`) 
  adj<-clean_res(adj_RR)%>% rename(`Adjusted\nEstimate`=Estimate, `Adjusted\np-value`=`p-value`)
  
  res <- left_join(unadj, adj, by=c("Study", "Sample", "Target"))
  res <- res %>% arrange(Study,  Sample,  Target) %>% filter(Study!="Pooled")
  res$`Adjusted\nEstimate`[res$Study=="Odagiri 2016"] <- ""
  res$`Adjusted\np-value`[res$Study=="Odagiri 2016"] <- ""
  return(res)
}

FitFlextableToPage <- function(ft, pgwidth = 10){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}


add_footnote_with_rlang <- function(df, col, pattern, symbol){
  form_ <- sprintf("~ %s == '%s'", col, pattern)
  colname <- enquo(col)
  flextable::compose(
    x = df, j = col, i = as.formula(form_), 
    value = as_paragraph(
      as_chunk(!!colname), 
      as_chunk(symbol, props = fp_text(vertical.align = 'superscript')))
  ) 
}

add_footnote <- function(df, col, pattern, symbol){
  form_ <- sprintf("~ %s == '%s'", col, pattern)
  flextable::compose(
    x = df, j = col, i = as.formula(form_), 
    value = as_paragraph(pattern,
      as_chunk(symbol, props = fp_text(vertical.align = 'superscript')))
    ) 
}



unadj_RR <- readRDS(file=here("results/unadjusted_aim2_pooled.Rds")) 
adj_RR <- readRDS(file=here("results/adjusted_aim2_pooled.Rds")) 
adj_emm <- readRDS(file=here("results/subgroup_aim2_pooled.Rds")) 

adj_RR_bin <- adj_RR %>% filter(Y %in% c("diar7d"), !is.na(pval))
adj_RR_cont <- adj_RR %>% filter(Y %in% c("haz"), !is.na(pval)) 


#Get percents significant


#Merge full env. with child health to see percent dropped 
env <- readRDS(paste0(dropboxDir,"Data/cleaned_ipd_env_data.rds"))
d <- readRDS(file=paste0(dropboxDir,"Data/merged_env_CH_data.rds"))

tab <- d %>% group_by(study, sample, target) %>%
  summarize(N=n(), N_pos=sum(pos), N_diar=sum(!is.na(diar7d)), N_pos_diar=sum(diar7d==1, na.rm=T), N_pos_env_diar=sum(pos==1 & diar7d==1, na.rm=T), N_haz=sum(!is.na(haz)))

colnames(tab)[4:9] <- c("N samples","N pos. samples","N diar. meas.", "N diar. pos.","N sample. and diar. pos.", "N haz")

tab1 <- tab %>% filter(sample=="any sample type", target=="Any pathogen")
tab2 <- tab %>% filter(sample=="any sample type", target=="Any MST")

load(here("figures/all_tables.Rdata"))
load(here("figures/aim2_figures.Rdata"))
load(here("figures/aim2_pathogen_specific_figures.Rdata"))
load(here("figures/aim2_abund_figures.Rdata"))
load(here("figures/aim2_covar_sig_figures.Rdata"))
load(here("figures/aim2_tmle_figures.Rdata"))
load(here("figures/aim2_pathogen_figures.Rdata"))
load(here("figures/aim2_diar_time_figures.Rdata"))
load(here("figures/aim2_adjusted_unadjusted_comp_figures.Rdata"))
load(here("figures/aim2_subgroup_figures.Rdata"))
load(here("figures/aim2_subgroup_figures_age.Rdata"))
load(here("figures/aim2_path_heatmap.Rdata"))
load(here("figures/aim2_abund_heatmap.Rdata"))



gv_res <- readRDS(file=paste0(here(),"/results/gv_merge_Ns.rds"))
mapsan_res <- readRDS(file=paste0(here(),"/results/mapsan_merge_Ns.rds"))
wbk_res <- readRDS(file=paste0(here(),"/results/wbk_merge_Ns.rds"))
wbb_res <- readRDS(file=paste0(here(),"/results/wbb_merge_Ns.rds"))
odisha_res <- readRDS(file=paste0(here(),"/results/odisha_merge_Ns.rds"))
merge_Ns <- bind_rows(
  gv_res, mapsan_res, wbb_res, wbk_res, odisha_res
)



```

```{css, echo=FALSE}
span.comment-start{
    background: #e0f3db;
}
span.comment-end{
    background: #e0f3db;
}
span.comment-start::after{
    content: " (" attr(author) ", " attr(date) ") [";
}
span.comment-end::before{
    content: "]"
}
span.comment-text{
    background: #fdbb84;
}


```

```{r, echo=FALSE}
commentN <- 0
cmt <- function(txt, cm, author, date = "2021-01-01", comN = commentN){
  cmt_str <- paste0('<span class="comment-text">[',cm,']{.comment-start id="', comN, '" author="', author, '" date="', date, '"}', txt, '[]{.comment-end id="',commentN,'"}</span>')
  assign("commentN", commentN + 1, envir = .GlobalEnv)
  return(cmt_str)
}
```


## Abstract


__Background:__ Water, sanitation and hygiene (WASH) improvements aim to reduce childhood enteric infections, subsequent diarrheal disease and growth faltering by reducing child exposure to fecal-orally transmitted pathogens in the environment. Until recently, trials of WASH interventions have primarily focused on documenting health outcomes such as caregiver-reported diarrhea without quantifying intermediate outcomes along the causal chain, such as detection of pathogens in environmental samples and in human biological specimens. Without measuring these causal intermediates, trials are limited to a "black box" understanding, where underlying mechanisms of interventions are unknown and investigators can only speculate about reasons for intervention success or failure.  Inspecting the causal chain is especially important given the small or null effects on child diarrhea and growth achieved in recent well-conducted trials of WASH interventions.  Additionally, studies that have collected environmental samples to date have primarily focused on drinking water (and, to a smaller extent, hands and food) while other pathways such as soil and surfaces in the domestic environment have received less attention. Furthermore, most studies have relied on measuring indicator organisms in the environment as a proxy for pathogens; these indicators can originate from non-fecal sources, cannot differentiate between human vs. animal fecal contamination, and correlate poorly with the presence of pathogen. Recent advances in DNA-based diagnostics now allow detection of a range of enteropathogens in human biological specimens and environmental samples, as well as distinction between human vs. animal fecal sources through molecular source tracking (MST) markers. We conducted an individual participant data (IPD) meta-analysis to pool data from WASH trials that have measured pathogens and/or MST markers in the environment to explore associations between pathogen presence in the environment and the gut, and any subsequent diarrheal infections and child growth sequelae,



__Methods:__ We conducted a systematic review and individual participant data meta-analysis to estimate enteropathogens and microbial source tracking (MST) markers in environmental samples. We used covariate-adjusted regression models with robust standard errors to estimate associations between. We estimated associations between aggregate and specific pathogens or MST markers and child diarrheal disease, height-for-age Z-scores (HAZ), weight-for-age Z-scores, weight-for-height Z-scores, and stunting, wasting, and underweight statuses. We used all growth outcomes measured after environmental sampling, but only used observations of diarrheal disease taken within four months of the date of environmental sampling. We also estimates associations stratified by child age, child sex, season, and animal presence in the household.


__Findings:__ We identified and received data from 9 sub-studies from five randomized or quasi-experimental studies. There was a small but consistent association between households with any pathogen contamination and children with lower HAZ (Adjusted mean difference pooled across studies: `r clean_est(adj_RR %>% filter(target=="Any pathogen", study=="Pooled", sample=="any sample type", Y=="haz"), outcome="gaussian")`), but there was no association with MST markers. The association between environmental pathogen contamination and HAZ was stronger for boys than girls. Associations were inconsistent for other growth outcomes. There was no consistent association between aggregate or individual enteropathogens or MST markers and caregiver reported diarrheal disease, though there was a significant increase in diarrheal disease risk in households with any pathogen presence in any sample during wet seasons when pooled across studies. Additionally specific pathogens in the environment were consistently associated with an increased risk of child infections with the same pathogen.


__Interpretation:__ No other studies have examined the association between enteropathogens and MST markers in environmental samples and child health outcomes in multiple low-resource settings and WASH contexts. While we found no association between environmental contamination and diarrheal disease, children had a higher risk of pathogen infections if the pathogen was found in environmental samples, highlighting the limitation of all-cause diarrheal disease as an outcome to assess the impact of WASH interventions to reduce environmental pathogen contaminations. MST markers did not have an association with child growth, but pathogen presence in the environment was associated with lower linear growth, especially among boys, though associations with specific pathogens were inconsistent. These results may have been affected by unmeasured confounding as well as the variable lengths of time between environmental sampling and child health ascertainment across the different studies.

<!-- __Funding:__ The Bill & Melinda Gates Foundation. -->

<!-- ## Research in context -->

<!-- __Evidence before this study.__ Children in areas with (sentence on env. pathogens may affect diarrheal disease). (Mention results from this field and rec water field) Quantifying the associations between general and specific enteric pathogens in environmental samples and measures of child health may help elucidate if (something on the identification of risky areas, or using env. sampling to assess the impacts of interventions or WASH programs). Most previous studies and meta-analyses to date on the effect of WASH interventions on fecal contamination in the environment have focused on fecal indicator bacteria, showing (FIB and health results, aim 1 manuscripts mentions limited association, look at references/discussion of this).  We conducted a systematic review and individual participant data meta-analysis of WASH intervention studies that measured enteropathogens or microbial source tracking (MST) markers in the environment and child diarrheal disease, enteropathogen infection, and growth outcomes to see if environmental pathogens or MST markers were associated with poor child health. -->

<!-- __Added value of this study.__ We successfully obtained data from 6 out of 7 ( __double check number__ ) eligible intervention studies identified in our systematic review that measured enteropathogens and MST markers in environmental samples and child diarrheal disease and growth outcomes. ( __XXX Update the following for aim2 results: Most individual studies indicated a protective effect of interventions on the prevalence of individual pathogens and MST markers, but most estimates were not statistically significant due to small sample sizes and rare detection of some of the targets. The individual participant data meta-analysis design of our study allowed us to detect a small but significant reduction in the prevalence of any type of pathogen in any type of sample by pooling across all studies. There was no overall intervention effect on the prevalence of MST markers. This study takes advantage of recently developed diagnostic methods to enumerate enteropathogens and host-specific fecal markers in a range of environmental samples, including understudied environmental reservoirs such as soil, to provide the first synthesis of evidence on the effect of WASH interventions on these specific targets in the domestic environment.__) -->

<!-- __Implications of all the available science.__ ( __Update based on aim 2 results__) The small reduction we observed in pathogen prevalence in the environment when pooled across all studies may explain the small effect the interventions had on child health. These findings also validate previous findings of no effect from sanitation interventions on fecal indicator bacteria in the environment, further demonstrating the insufficiency of basic sanitation solutions in reducing fecal contamination in the environment. Possibly, more intensive WASH interventions like safely managed water and sanitation are needed to reduce environmental contamination enough to improve child health. We note that only a small number of trials met our inclusion criteria and only a subset of households was sampled in each study. Pathogen targets and diagnostic methods varied by study. Future research would benefit from sampling a more diverse set of WASH interventions using a standardized set of laboratory methods to enumerate a common range of pathogen and MST targets. -->




<!-- ## Summary -->

<!-- -Pathogen-specific significant associations -->
<!-- -Overall associations are null -->
<!-- -specific significant findings -->
<!-- Season diff in diarrhea and sex difference in HAZ -->


<!-- Most study-specific estimates are null, with inconsistent direction of effects in significant associations. Estimates pooled over multiple studies were also null, except for a small and marginally significant association between any enteropathogen in any sample and lower child height-for-age Z-scores (which is significant without adjustment for confounders). -->

## Methods

We examined associations between prevalence of enteropathogens and MST markers in the environment and child health outcomes, including all-cause diarrheal disease, child growth, and enteropathogen-specific infections. The primary outcomes for all exposures were caregiver recall of diarrheal disease and child height-for-age Z-scores. For specific enteropathogen presences in the environment, primary outcomes also included the corresponding enteropathogen detection in child stool. Secondary outcomes include z-scores for weight-for-age (WAZ) and weight-for-length (WLZ) and prevalence of stunting, wasting and underweight. For the growth outcomes outcomes, we considered all environmental samples collected over the child's lifetime prior to the anthropometry measurement. For the diarrheal disease and enteropathogen-specific infection outcomes, we will only consider environmental samples collected up to four months before the measurement of the health outcome.

For binary outcomes, we estimated prevalence ratios using modified Poisson regressions.[@zouModifiedPoissonRegression2004] For continuous outcomes (child anthropometry Z-scores), we used linear regressions to estimate adjusted mean differences. Because of repeated sampling or clustered designs in some studies, we used the Huber Sandwich Estimator to calculate robust standard errors.[@freedmanSoCalledHuberSandwich2006] All analyses were adjusted for potential confounders. We included child age and asset-based household wealth as adjustment covariates for all adjusted estimates. Other covariates were prescreened using likelihood ratio tests, and only variables associated with the outcome with a p-value < 0.2 were included in the model for each outcome. We included the following variables in the prescreening set if they were measured within an included study: child age, child sex, maternal age, household food security status, number of people in the household, age and education of primary caregiver in the household, asset-based household wealth, number of rooms, construction materials (walls, floor, roof), access to electricity, land ownership and if anyone in the household works in agriculture. Within each study, we only estimated associations when there were at least 5 cases of the binary outcome in the rarest strata of the exposure.


## Results

Due to the smaller sample size of the environmental samples within the WASH trials and quasi-randomized studies, the rarity of diarrheal disease in children, and the rarity of many of the enteropathogen in environmental samples, data sparsity affected what was possible in this analysis. Many exposure-outcome associations were not estimated due to data sparsity, and others were estimated but could only be adjusted for a subset of potential confounders. Table 1 shows the number of health observations with corresponding environmental samples, the prevalence of diarrheal disease and measures of child growth failure, and mean child anthropometry Z-scores by study.
  
In general, enteropathogen and host-specific fecal markers were not associated with child diarrheal disease risk.The presence of any enteropathogen or any mst marker in any environmental samples were not associated with diarrheal disease, except any enteropathogen presence located on child hands in Boehm et al. 2016 (Figure 1). Enteropathogen presence on child hands in Boehm et al. 2016 might be significantly associated with diarrhea while other estimates are not for several reasons, Boehm et al. 2016 is the only included study where diarrhea was measured <1 week after env sampling, the only pathogen it measured was rotavirus, so aggregate enteropathogens only includes rotavirus (the most common diarrheal pathogen in young children worldwide) for this study, and in general child hands are a major source of fecal exposure for kids, both in terms of estimated E.coli ingestion[@mattioliHandtomouthContactsResult2015] and associations between E. coli and diarrhea.[@pickeringFecalIndicatorBacteria2018] There was no significant associations between specific groups of MST markers and child diarrheal disease in any sample type (Figure 4). Most associations between specific pathogens in the environment and child diarrheal disease were null, but *Giardia* in latrine soil in Capone et al. 2021 and Rotavirus on child hands in Boehm et al. 2016 were both significantly associated with approximately twice the risk of diarrheal disease in children (Figure 5). Specific MST markers in environmental samples were generally not associated with the risk of diarrheal disease but the avian MST marker GSD was significantly associated with an increased diarrheal disease risk in Mapsan latrine soil samples, and had non-significant but positive association in all three sample types from Boehm et al 2016 (Figure 6). There are inconsistent associations between the abundance of specific enteropathogens and MST markers and child diarrheal disease, with most estimates having null effects, and with significant effects occurring in both harmful and protective directions (Figures 7-8).

Pooled across studies, there was a significant increase in child diarrheal disease risk in compounds with any sample with any enteropathogen detected when the child diarrheal disease occurred during the wet season (Figure 9), when diarrheal disease risk is elevated, potentially due to rainfall flushing environmental pathogens into contact with children.[@kraayUnderstandingImpactRainfall; @mertensAssociationsHighTemperature] There was no association with MST markers in either season. Diarrheal disease was too sparse to estimate differences in associations between households with and without animals, and there was no difference in associations when analyses were stratified by child sex or age (Figures 11,13). Lastly, the choice to use a maximum of four months as a time window between sampling and diarrheal disease did not obscure major trends in the associations between any enteropathogen or any MST marker in environment and diarrheal disease, as results were similar when using all diarrhea observations or when only using diarrhea observations within a month of the environmental sampling date. Most associations were null regardless of the time window.

The presence of any enteropathogen (but not any MST marker) in any environmental sample was significantly associated with lower height-for-age Z-scores (HAZ) when pooled across studies (Adjusted mean difference: `r clean_est(adj_RR %>% filter(target=="Any pathogen", study=="Pooled", sample=="any sample type", Y=="haz"), outcome="gaussian")`, Figure 2). This was driven primarily by the number of slightly harmful but insignificant effects rather than by any strong effect of any enteropathogen in specific studies or sample types, highlighting the strength of IPD meta-analyses. Nevertheless, water samples with any enteropathogen presence were also significantly associated with lower mean HAZ in Boehm et al. 2016. Also, there was a borderline reduced HAZ associated with any pathogen in soil when pooled across studies. Any MST presence in water was also significantly associated with lower mean HAZ in Boehm 2016, but was associated with higher mean HAZ in latrine soil samples in Holcomb et al. 2020. 

When separated out by groups of enteropathogen, enteropathogen presence in any environmental sample is no longer significantly associated with lower HAZ when pooled across studies, though sample positivity with any STH has a pooled borderline association with reduced HAZ (Figure 4). Additionally, any virus presence on child hands was significantly associated with lower mean HAZ in Boehm et al. 2016 and any protozoa in water was significantly associated with lower mean HAZ in Furhmeister et al. 2020, both from the WASH Benefits Bangladesh trial. There is also a general trend of presence of groups of MST markers in water samples being associated with lower mean HAZ (Figure 4). There were inconsistent associations between the presence of  specific enteropathogens or specific MST markers and child HAZ scores, with most estimates having null effects (Figures 5-6). Of the statistically significant associations, half of the sample-specific estimates were associated with increased linear growth and half were associated with decreased linear growth. There are inconsistent associations between the abundance of specific enteropathogens and MST markers and child HAZ scores, with most estimates having null effects, and with significant effects occurring in both harmful and protective directions (Figures 7-8).

Pooled across studies, there was a significant decrease in child HAZ in compounds with any sample with any enteropathogen detected when the child lives in a compound with no animals, but not when animals were in the compound (Figure 10). There was no association with MST markers. There was no consistent relationship between child age and the strengths associations between environmental pathogens or MST markers and HAZ (Figure 14), but there appears to be a sex difference. The presence of any pathogen in any environmental sample was associated with a larger decrease in height-for-age Z-scores among boys than among girls in most studies, though the difference was only significant in Steinbaum 2019 (Figure 12). Pooled across studies, pathogen presence was associated with twice the reduction in Z-scores in boys (Adjusted mean difference: `r clean_est(adj_emm %>% filter(target=="Any pathogen", study=="Pooled", V=="sex", Vlevel==0, sample=="any sample type", Y=="haz"), outcome="gaussian")`) than in girls (Adjusted mean difference: `r clean_est(adj_emm %>% filter(target=="Any pathogen", study=="Pooled", V=="sex", Vlevel==1, sample=="any sample type", Y=="haz"), outcome="gaussian")`).

For other measures of growth, there were inconsistent associations between the presene or abundance of any enteropathogen or any MST marker and WHZ, WAZ, stunting, and underweight, with most estimates having null effects, and with significant effects occurring in both harmful and protective directions (Figures 4-8).

<!-- Most associations between the abundance of any enteropathogen or any MST marker and child WAZ scores were null effects, but any MST marker in soil in Furhmeister et al. and any enteropathogen or any MST marker in stored drinking water in Boehm et al. 2016 were associated with children having a significantly lower WAZ (Figure XXX). -->

<!--   While most study- and sample-specific estimates were not significant, any enteropathogen presence in any sample was associated with a significant increased risk of stunting when pooled across studies (Relative risk: `r clean_est(adj_RR %>% filter(target=="Any pathogen", study=="Pooled", sample=="any sample type", Y=="stunt"), outcome="binomial")`, Figure XXX). MST marker presence in samples was not associated with stunting, except in any sample in Fuhrmeister et al. 2020 where presence was unexpectadly associated with a reduction in stunting. -->
<!--  enteropathogen and MST marker presence was not associated with wasting (Figure XXX). -->
<!-- enteropathogen presence was not associated with child underweight status, but MST marker presence in samples was unexpectadly associated with child underweight status in Boehm et al. 2016 and in any sample and in samples from mothers' hands in Fuhrmeister et al. 2020. (Figure XXX). -->

In contrast to the lack of associations with diarrhea, there was a general trend of positive associations between specific enteropathogens in the compound environment and an increased risk of the same enteropathogen infecting the child living in the compound across different enteropathogens and sample types (Figure 3). *Giardia* and enteropathogenic *E. coli* were two enteropathogens without significant associations between environmental presence and child infection, but associations were borderline significant for the two Capone et al. studies. Associations were significant or near significant for  *Shigella*, *Ascaris*, and *Trichuris* presence in soil and fly samples and infections across multiple studies. *C. difficile* was only measured in latrine soil in Capone et al. 2021, but had the strongest association with infections in the children among specific enteropathogens. These findings highlight the limitations of self-reported all-cause diarrhea as an outcome to assess the impact on environmental pathogen contamination. Additionally, the link between pathogens in the environment and in child stool samples provides a link in the causal chain between environmental contamination and lower child HAZ, though the analysis was limited by the small number of pathogens measured in both the environment and children.  
        
We conducted several sensitivity analyses. Comparison between associations estimated with generalized linear models (GLM) and machine-learning based targeted likelihood estimation models (TMLE) for the diarrhea outcome. The estimation approach chosen did not affect our conclusions about associations between environmental contamination and diarrheal disease or HAZ. Associations between adjustment covariates and the presence of different enteropathogen and MST markers in different environmental samples. Most covariates were not strongly associated with enteropathogen or MST marker presence in the environment, meaning they were not strong confounders of the relationship between environmental contamination with enteropathogen or MST markers and child infections or poor growth. Measures of household wealth generally had the strongest association with environmental contamination, though the association varied by study, sample, and microbial target. Between the low association between covariates and environmental contamination, and the generally limited differences between unadjusted, adjusted, and TMLE estimates, we believe our modeling approach adequetly adjusted for measured confounding, but unmeasured confounding may bias the results. The average associations were slightly larger in magnitude after covariate adjustment. On average the covariate adjustment had small effects on the results though it was slightly greater when a larger number of covariates were used for adjustment.  There were also no significant differences in pooled estimates between the one urban study (Holcomb et al. 2020) and the four rural studies.



<!-- Adjusted diarrheal disease prevalence ratio for any enteropathogen presence in any environmental sample: -->
<!-- `r clean_est(adj_RR %>% filter(target=="Any enteropathogen", study=="Pooled", sample=="any sample type", Y=="diar7d"))` -->


<!-- Adjusted HAZ difference for any enteropathogen presence in any environmental sample: -->

<!-- `r clean_est(adj_RR %>% filter(target=="Any enteropathogen", study=="Pooled", sample=="any sample type", Y=="haz"), outcome="gaussian")` -->

<!-- Significant stunting: `r clean_est(adj_RR %>% filter(target=="Any enteropathogen", study=="Pooled", sample=="any sample type", Y=="stunt"), outcome="binomial")` -->

<!-- `r clean_est(adj_RR %>% filter(target=="Any enteropathogen", study=="Pooled", sample=="any sample type", Y=="wast"), outcome="binomial")` -->
<!-- `r clean_est(adj_RR %>% filter(target=="Any enteropathogen", study=="Pooled", sample=="any sample type", Y=="underwt"), outcome="binomial")` -->

<!-- Interquartile range for the ratio of adjusted and unadjusted prevalence rations: [0.97, 1.05] -->
<!-- Interquartile range for the difference of adjusted and unadjusted prevalence rations: [-0.014,  0.061] -->

<!-- -percent significant of all estimates -->




<!-- Percent of diarrhea estimates significant -->
<!-- `r round(prop.table(table(adj_RR_bin$pval < 0.05))[2] * 100,1)` -->

<!-- Percent of diarrhea estimates significant and harmful -->
<!-- `r round(prop.table(table(adj_RR_bin$pval < 0.05 & adj_RR_bin$RR > 1))[2] * 100,1)` -->

<!-- Percent of HAZ estimates significant -->
<!-- `r round(prop.table(table(adj_RR_cont$pval < 0.05))[2] * 100,1)` -->

<!-- Percent of HAZ estimates significant and harmful -->
<!-- `r round(prop.table(table(adj_RR_cont$pval < 0.05 & adj_RR_cont$coef < 0))[2] * 100,1)` -->





<!-- The average ratio in binary outcomes between environmental samples positive for enteropathogens or MST markers and those negative for enteropathogens or MST markers is slightly larger in magnitude after covariate adjustment. On average the covariate adjustment had small effects on the results though it was slightly greater when a larger number of covariates were used for adjustment.  -->

<!-- The average difference in Z-scores between environmental samples positive for enteropathogens or MST markers and those negative for enteropathogens or MST markers is slightly larger in magnitude after covariate adjustment, but on average the covariate adjustment had small effects on the results and did not vary by number of covariates used for adjustment.  -->



<!-- ## Discussion -->

<!--   *  Make sure to look at if the WAZ outcomes (which are in odigari instead of HAZ) are sig for odigari -->
<!--   *  Self reported diarrhea a bad outcome; contrast null results with the significant pathogen specific results -->



<!-- ## Overall notes on data availability: -->

<!-- Odagiri et al. 2016 only measured weight, so we only have WAZ, and Reese only measures/shared height, so we only have HAZ. -->
<!-- The tables at the bottom of the report show the number of samples and number of health outcomes by study the column for both positive sample and diarrhea measure is likely the limiting factor for sparse analyses. -->
<!--   (Give specific numbers for these tables) -->


<!-- ## Notes on analysis -->

<!-- The analysis included baseline (pre-intervention) measurements. -->
<!-- All primary estimates are adjusted for intervention arm and child and household covariates. -->
<!-- Only child health measurements taken after environmental samples were used. -->
<!-- Diarrhea measurements must have occured after environmental samples, but within 4 months of environmental sample collection. -->
<!-- Environmental samples were matched to the most proximate child health outcome, without using multiple measurements. For example, environmental samples at baseline were matched to child anthropometry and midline, but not endline. -->

<!-- ## Notes on time ordering of environmental samples and child health outcomes, and data merging by study -->

<!-- #### WASH Benefits Bangladesh -->

<!-- Endline (year 2) anthropometry and diarrhea was used for Kwong et al. 2021 (STH samples) -->
<!-- World Bank substudy diarrhea and anthropometry was used for Boehm et al. 2016 -->
<!-- R01 substudy diarrhea and anthropometry was used for Fuhrmeister et al. 2020. The substudy was conducted over 8 rounds taken around 3 months apart, with environmental sampling occurring in rounds 3 and 4. Environmental samples were merged to diarrhea from the subsequent round and anthropometry from the main trial endline (year two) sampling. -->



<!-- #### WASH Benefits Kenya -->

<!-- Endline (year 2) anthropometry and diarrhea was used. -->


<!-- #### Mapsan -->

<!-- The Mapsan trial had three sampling rounds, baseline, midline, and endline, each 12 months -->
<!-- The Mapsan trial environmental sampling data is divided into three studies which had differences in samples, microbial targets, and sampling times, Holcomb et al 2020 (baseline and midline), Capone et al 2021 (baseline and endline), and  Capone et al 2021 in prep. (baseline and midline). -->
<!-- Diarrhea was used from concurrent rounds, while anthropometry was used from subsequent rounds, except for endline environmental samples, where concurrent anthropometry was used. -->

<!-- #### Odisha -->

<!-- Environmental samples were shared already merged with child health data, but samples outside of the specified time range for diarrhea or taken before environmental -->

<!-- #### Gram Vikas -->
<!-- Sampling rounds were approximately 4 months apart, so anthropometry data was taken from subsequent round, and diarrhea data was taken from either the current or subsequent round, based on which sample was taken after but closer to the environmental sampling, and within 4 months. -->






<!-- ## Limitations -->

<!-- - Unmeasured confounding -->
<!-- - Small sample size -->
<!-- - Timing of measurements -->
<!-- - we didn't see estimates move that much with many variables to adjust for. -->

<!-- # Scratch (Comment out) -->

<!--  *  __NOTE: MOVE THIS TO METHODS__ Comparison between associations estimated in the primary diarrhea analysis (diarrheal disease occurring after environmental sampling, but no more than 4 months later with associations estimated only using diarrheal disease cases within 1 month, or occuring at any time). For the analysis of all diarrhea, it included diarrheal cases, even cases occuring prior to sampling, under the hypothesis that enteropathogen presence at one time is a surrogate variable for general environmental contamination. The choice to use a maximum of four months as a time window between sampling and diarrheal disease did not obscure major trends in the associations between any enteropathogen or any MST marker in environment and diarrheal disease (Figure 21). Most associations were null regardless of the time window. -->


# Primary figures

```{r p_diar_1_adj, fig.cap = "Forest plots of associations between child diarrheal disease and the prevalence of any enteropathogen or any MST markers in different types of environmental samples. Pooled estimates are presented when there are four or more study-specific estimates for a specific sample type and target combination and are denoted with diamond-shaped points. Grey crossed points denote data that were too sparse to estimate a prevalence ratio (i.e., <10 positive or negative observations). Samples of the same type from different locations (source vs. stored water, flies in kitchen vs. latrine, soil from courtyard vs. latrine) or different individuals (child vs. mother's hands) are plotted separately. Asterisks above estimates denote statistical significance (\\*= P-value < 0.05, \\*\\*= P-value < 0.01, \\*\\*\\*= P-value < 0.001). All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 5}
p_diar_1_adj
```


```{r p_haz_1_adj, fig.cap ="Forest plots of associations between child HAZ and the prevalence of any enteropathogen or any MST markers in different types of environmental samples. Pooled estimates are presented when there are four or more study-specific estimates for a specific sample type and target combination and are denoted with diamond-shaped points. Grey crossed points denote data that were too sparse to estimate a mean difference. Samples of the same type from different locations (source vs. stored water, flies in kitchen vs. latrine, soil from courtyard vs. latrine) or different individuals (child vs. mother's hands) are plotted separately.  All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 5}
p_haz_1_adj
```



```{r p_pathogen, fig.cap ="Forest plots of associations between specific enteropathogens in environmental samples and child infections with the same enteropathogens.  Samples of the same type from different locations (source vs. stored water, flies in kitchen vs. latrine, soil from courtyard vs. latrine) or different individuals (child vs. mother's hands) are plotted separately and denoted by different colors.  All estimates are adjusted for potential confounders.",  echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_pathogen
```


# Supplimentary figures


```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 6, }
hm_agg <- ggplot(hm_df_agg, aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
        size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
        size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
        guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
    #facet_grid(target~., scales = "free", space="free") 
    ggforce::facet_grid_paginate(target~., scales = "free", space="free", ncol=1, nrow = 5, page = 1)

plot(hm_agg)


```

```{r hm_agg2, fig.cap = "Heatmap of significance and direction of associations between aggregate measures of environmental contamination and child diarrhea and growth outcomes. Cells are colored by the strength of significance and direction of association, and the point estimate and confidence intervals are printed within cells, with relative risks printed for binary outcomes and mean differences for continuous outcomes. Each row is for a different sample type in a specific study, and pooled estimates are not plotted. Estimates aggregated across any sample type are only plotted if there are multiple sample types for a study. All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6, }


hm_df_agg <- hm_df_agg %>% arrange(target)

hm_agg <- ggplot(hm_df_agg %>% filter(!(target %in% unique(hm_df_agg$target)[1:5])) %>% droplevels(), aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
        size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
        size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
        guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
    facet_grid(target~., scales = "free", space="free") 
    #ggforce::facet_grid_paginate(target~., scales = "free", space="free", ncol=1, nrow = 9, page = 1)

plot(hm_agg)


```

 


```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}

hm1 <- ggplot(hm_df_path, aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
        size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
        size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
        guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
    #facet_grid(target~., scales = "free", space="free") 
    ggforce::facet_grid_paginate(target~., scales = "free", space="free", ncol=1, nrow = 9, page = 1)

plot(hm1)


```

```{r hm2, fig.cap = "Heatmap of significance and direction of associations between specific pathogens in environmental samples and child diarrhea and growth outcomes. Cells are colored by the strength of significance and direction of association, and the point estimate and confidence intervals are printed within cells, with relative risks printed for binary outcomes and mean differences for continuous outcomes. Each row is for a different sample type in a specific study, and pooled estimates are not plotted. Estimates aggregated across any sample type are only plotted if there are multiple sample types for a study. All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}

hm_df_path <- hm_df_path %>% arrange(target)

hm2 <- ggplot(hm_df_path %>% filter(!(target %in% unique(hm_df_path$target)[1:9])) %>% droplevels(), 
              aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
        size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
        size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
        guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
    facet_grid(target~., scales = "free", space="free") 
    #ggforce::facet_grid_paginate(target~., scales = "free", space="free", ncol=1,  nrow = 1, page = 2)
    #ggforce::facet_wrap_paginate(target~., scales = "free", ncol=1,  nrow = 9, page = 2)

plot(hm2)


```






```{r hm_mst, fig.cap = "Heatmap of significance and direction of associations between specific microbial source tracking markers in environmental samples and child diarrhea and growth outcomes. Cells are colored by the strength of significance and direction of association, and the point estimate and confidence intervals are printed within cells, with relative risks printed for binary outcomes and mean differences for continuous outcomes. Each row is for a different sample type in a specific study, and pooled estimates are not plotted. Estimates aggregated across any sample type are only plotted if there are multiple sample types for a study. All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}

hm_mst <- ggplot(hm_df_mst, aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
                                    size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
                                                                                                                         size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
  facet_grid(target~., scales = "free", space="free") 
  #ggforce::facet_grid_paginate(target~., scales = "free", space="free", ncol=1,  nrow = 9, page = 1)

plot(hm_mst)


```







```{r hm1_abund, fig.cap = "Heatmap of significance and direction of associations between  the abundance of specific pathogens in environmental samples and child diarrhea and growth outcomes. Cells are colored by the strength of significance and direction of association, and the point estimate and confidence intervals are printed within cells, with relative risks printed for binary outcomes and mean differences for continuous outcomes. Each row is for a different sample type in a specific study, and pooled estimates are not plotted. Estimates aggregated across any sample type are only plotted if there are multiple sample types for a study. All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}

hm1_abund <- ggplot(hm_df_path_abund, aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
        size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
        size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
        guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
    facet_grid(target~., scales = "free", space="free") 

plot(hm1_abund)


```







```{r hm_mst_abund, fig.cap = "Heatmap of significance and direction of associations between  the abundance of specific microbial source tracking markers in environmental samples and child diarrhea and growth outcomes. Cells are colored by the strength of significance and direction of association, and the point estimate and confidence intervals are printed within cells, with relative risks printed for binary outcomes and mean differences for continuous outcomes. Each row is for a different sample type in a specific study, and pooled estimates are not plotted. Estimates aggregated across any sample type are only plotted if there are multiple sample types for a study. All estimates are adjusted for potential confounders.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}

hm_mst_abund <- ggplot(hm_df_mst_abund, aes(x = Y, y = X, fill = pval_cat )) + 
  geom_tile(colour = "grey80", size = 0.25) + scale_x_discrete(expand = c(0, 0)) + 
  scale_y_discrete(expand = c(0, 0)) + 
  theme_minimal(base_size = 8) +
  scale_fill_manual(values = colours, drop = FALSE) +
  geom_text(aes(label = est), size=2.25) +
  theme(legend.title = element_text(color = textcol,
                                    size = 8), legend.margin = margin(grid::unit(0.1, "cm")), legend.text = element_text(colour = textcol,
                                                                                                                         size = 7, face = "bold"), legend.key.height = grid::unit(0.2,   "cm"), legend.key.width = grid::unit(1, "cm"),
        legend.position = "bottom", axis.text.x = element_text(size = 8,  colour = textcol), 
        axis.text.y = element_text(size = 8, vjust = 0.2, colour = textcol), axis.ticks = element_line(size = 0.4),
        plot.title = element_text(colour = textcol, hjust = 0, size = 12, face = "bold"), strip.text.x = element_text(size = 10),
        strip.text.y = element_text(angle = 0, size = 10),
        plot.background = element_blank(), panel.border = element_blank(),
        strip.background = element_blank(), panel.background = element_rect(fill = "grey80", colour = "grey80"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  guides(fill = guide_legend("P-value strength", nrow = 2)) + labs(x = "", y = "", title = "") +
  facet_grid(target~., scales = "free", space="free") 
  #ggforce::facet_grid_paginate(target~., scales = "free", space="free", ncol=1,  nrow = 9, page = 1)

plot(hm_mst_abund)


```




## Subgroup analysis

```{r p_wet_diar_2, fig.cap = "Forest plots of relative risks between diarrhea disease and any enteropathogen, and any MST markers, in different types of environmental samples, stratified by whether the diarrheal disease occurred during the wet versus dry season (defined by the 6 months of highest average rainfall). Significant effect modification, as determined by the p-values on the regression model interaction term, is marked with asterisks (P < 0.05 = \\*, P < 0.01 = \\*\\*, P < 0.001 = \\*\\*\\*).", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_wet_diar_2
```





```{r p_animals_haz_1, fig.cap = "Forest plots of associations between child HAZ and any enteropathogen, and any MST markers, in different types of environmental samples, stratified by whether any animals were present in the compound. Significant effect modification, as determined by the p-values on the regression model interaction term, is marked with asterisks (P < 0.05 = \\*, P < 0.01 = \\*\\*, P < 0.001 = \\*\\*\\*).", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_animals_haz_1
```


```{r p_sex_diar_1, fig.cap = "Forest plots of associations between child diarrheal disease and any enteropathogen, and any MST markers, in different types of environmental samples, stratified by child sex. Significant effect modification, as determined by the p-values on the regression model interaction term, is marked with asterisks (P < 0.05 = \\*, P < 0.01 = \\*\\*, P < 0.001 = \\*\\*\\*).", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_sex_diar_1
```

```{r p_sex_haz_1, fig.cap = "Forest plots of associations between child HAZ and any enteropathogen, and any MST markers, in different types of environmental samples, stratified by child sex. Significant effect modification, as determined by the p-values on the regression model interaction term, is marked with asterisks (P < 0.05 = \\*, P < 0.01 = \\*\\*, P < 0.001 = \\*\\*\\*).", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_sex_haz_1
```


```{r p_age_diar_1, fig.cap = "Forest plots of associations between child diarrheal disease and any enteropathogen, and any MST markers, in different types of environmental samples, stratified by child age,", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_age_diar_1
```

```{r p_age_haz_1, fig.cap = "Forest plots of associations between child HAZ and any enteropathogen, and any MST markers, in different types of environmental samples, stratified by child age.", echo=F, warning=F, message=F, fig.width = 10, fig.height = 6}
p_age_haz_1
```





# Tables


```{r tab_Y, fig.cap = "Descriptive statistics of child health outcomes by study.", echo=FALSE, warning=F, message=F}
FitFlextableToPage(flextable(tab_Y))
```





## References