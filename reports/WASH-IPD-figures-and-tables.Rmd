---
title: "WASH IPD figure and tables"
author: "Andrew Mertens"
date: "1/3/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(warn = -1) 
library(janitor)
library(knitr)
library(here)
library(table1)
library(rvest)

source(here("0-config.R"))


op = function(x, d=2) sprintf(paste0("%1.",d,"f"), x) 
 library(pander)
panderOptions('digits', 2)
panderOptions('round', 2)
panderOptions('keep.trailing.zeros', TRUE)
panderOptions('graph.fontsize', 8)

panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)

resRR <- readRDS(file=here("results/pooled_RR.Rds"))

load(here("figures/all_tables.Rdata"))
load(here("figures/agg_tables.Rdata"))
load(here("figures/abundance_tables.Rdata"))
load(here("figures/all_figures.Rdata"))
load(here("figures/density_figures.Rdata"))
load(here("figures/outcome_groups.Rdata"))

#load(here("figures/abundance_table_ROQ.Rdata"))
abund_ROQ <- read.csv(here("figures/abundance_table_ROQ.csv"))
abund_ROQ <-abund_ROQ %>% subset(., select= c(-X))

```


<!-- ## List of pathogen/MST outcomes by group -->

<!-- ```{r, echo=T, warning=F, message=F} -->
<!-- any_pathogens  -->
<!--      any_virus -->
<!--      any_bacteria -->
<!--      any_protozoa  -->
<!--      general_MST  -->
<!--      animal_MST  -->
<!--      human_MST  -->
<!--      any_MST  -->
<!-- ``` -->

## Pooled relative risk for any pathogen in any sample

```{r, echo=F, warning=F, message=F}
knitr::kable(resRR[-c(1:2)])

```

## Table 1. Prevalence of pathogens by sample type tested in each study

```{r, echo=F, warning=F, message=F}
knitr::kable(target_presence_long_P)

```

## Table 2. Prevalence of microbial source tracking markers by sample type tested in each study

```{r, echo=F, warning=F, message=F}
knitr::kable(target_presence_long_MST)

```


## Primary figures


```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 10}

p_1

```

__Figure 1.__ Forest plots of intervention effects on any enteropathogen, and any general,  human and animal MST markers in different samples of environmental samples.

```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 10}
p_s1
```

__Figure S1.__ Prevalence of any virus, any bacteria, any protozoa and any STH 


```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 15}
p_s3
```

__Figure S3.__ Prevalence of specific pathogens 


```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 15}
p_s4
```
__Figure S4.__ Prevalence of specific MST markers 


<!-- # ```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 5} -->
<!-- # p_s5 -->
<!-- # ``` -->

__Figure S5.__ Abundance of specific pathogens 


<!-- # ```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 15} -->
<!-- # p_s6 -->
<!-- # ``` -->

__Figure S6.__ Abundance of specific MST markers 


<!-- # ```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 15} -->
<!-- # p_s7 -->
<!-- # ``` -->

__Figure S7.__ Repeat of Figure 1, adjusted  


<!-- # ```{r, echo=F, warning=F, message=F, fig.width = 10, fig.height = 15} -->
<!-- # p_s8 -->
<!-- # ``` -->

__Figure S8.__ Repeat of Figure 1, broken down by rural/urban.

__Figure S9.__ Repeat of Figure 1, broken down by season. 

__Figure S10.__ Repeat of Figure 1, broken down by  animal ownership.


## Abundance density figures

For internal use, and to discuss which can be analyzed with linear regressions. We should discuss the MST measures with non-normal discutirbutions due to high number of BLOD and BLOQ observations.

<!-- #### Log10-transformed -->

<!-- ```{r, echo=F, warning=F, message=F, fig.width = 5, fig.height = 5} -->
<!-- logplotlist -->
<!-- ``` -->


<!-- #### Raw -->

<!-- ```{r, echo=F, warning=F, message=F, fig.width = 5, fig.height = 5} -->
<!-- plotlist -->
<!-- ``` -->


## Abundance table

N's and percents for ROQ, BLOQ, and BLOD measures, and raw and log10 transformed means and medians of ROQ abundances. P-values are test of normality on raw and log-10 transformed datas (Null hypothesis is normality). The analysis column is my proposed analysis approach.

```{r, echo=F, warning=F, message=F}
knitr::kable(abund_ROQ)

```

## QA check tables
```{r, echo=F, warning=F, message=F}
knitr::kable(d_any_pathogen$tab)
knitr::kable(d_any_virus$tab)
knitr::kable(d_any_protozoa$tab)
knitr::kable(d_any_bacteria$tab)
knitr::kable(d_any_general_MST$tab)
knitr::kable(d_any_human_MST$tab)
knitr::kable(d_any_animal_MST$tab)

```

## Tables

<!-- #### MST/pathogen targets by sample sample and study -->

<!-- ```{r, echo=F, warning=F, message=F} -->


<!-- tab1 -->


<!-- ``` -->

#### Any pathogens + specific pathogens prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(any_pathogens_tab)
```

#### Any virus + specific virus prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(any_virus_tab)
```

#### Any bacteria + specific bacteria prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(any_bacteria_tab)
```

#### Any helminth + specific helminth prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(any_helminth_tab)
```

#### Any protozoa + specific protozoa prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(any_protozoa_tab)
```

#### Any general MST + specific general MST prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(general_MST_tab)
```

#### Any animal MST + specific animal MST prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(animal_MST_tab)
```

#### Any human MST + specific human MST prevalences (N) and mean abundances by study

```{r, echo=F, warning=F, message=F}
knitr::kable(human_MST_tab)
```



<!-- #### Covariate summaries by study (tabulation in progress for Gram Vikas) -->

<!-- ```{r, echo=F, warning=F, message=F} -->

<!-- tab2 -->

<!-- ``` -->
